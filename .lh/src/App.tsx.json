{
    "sourceFile": "src/App.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1767802357951,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1767802357951,
            "name": "Commit-0",
            "content": "import { Alert, Avatar, Box, Button, CircularProgress, Container, MenuItem, Select, Stack, TextField, Typography } from '@mui/material';\r\nimport MetricsBar from '@/components/MetricsBar';\r\nimport TaskTable from '@/components/TaskTable';\r\nimport UndoSnackbar from '@/components/UndoSnackbar';\r\nimport { useCallback, useMemo, useState } from 'react';\r\nimport { UserProvider, useUser } from '@/context/UserContext';\r\nimport { TasksProvider, useTasksContext } from '@/context/TasksContext';\r\nimport ChartsDashboard from '@/components/ChartsDashboard';\r\nimport AnalyticsDashboard from '@/components/AnalyticsDashboard';\r\nimport ActivityLog, { ActivityItem } from '@/components/ActivityLog';\r\nimport { downloadCSV, toCSV } from '@/utils/csv';\r\nimport type { Task } from '@/types';\r\nimport {\r\n  computeAverageROI,\r\n  computePerformanceGrade,\r\n  computeRevenuePerHour,\r\n  computeTimeEfficiency,\r\n  computeTotalRevenue,\r\n} from '@/utils/logic';\r\n\r\nfunction AppContent() {\r\n  const { loading, error, metrics, derivedSorted, addTask, updateTask, deleteTask, undoDelete, lastDeleted, clearLastDeleted } = useTasksContext();\r\n  const handleCloseUndo = useCallback(() => {\r\n    clearLastDeleted();\r\n  }, [clearLastDeleted]);\r\n  const [q, setQ] = useState('');\r\n  const [fStatus, setFStatus] = useState<string>('All');\r\n  const [fPriority, setFPriority] = useState<string>('All');\r\n  const { user } = useUser();\r\n  const [activity, setActivity] = useState<ActivityItem[]>([]);\r\n  const createActivity = useCallback((type: ActivityItem['type'], summary: string): ActivityItem => ({\r\n    id: (typeof crypto !== 'undefined' && 'randomUUID' in crypto ? crypto.randomUUID() : `${Date.now()}-${Math.random().toString(16).slice(2)}`),\r\n    ts: Date.now(),\r\n    type,\r\n    summary,\r\n  }), []);\r\n\r\n  const filtered = useMemo(() => {\r\n    return derivedSorted.filter(t => {\r\n      if (q && !t.title.toLowerCase().includes(q.toLowerCase())) return false;\r\n      if (fStatus !== 'All' && t.status !== fStatus) return false;\r\n      if (fPriority !== 'All' && t.priority !== fPriority) return false;\r\n      return true;\r\n    });\r\n  }, [derivedSorted, q, fStatus, fPriority]);\r\n\r\n  const handleAdd = useCallback((payload: Omit<Task, 'id'>) => {\r\n    addTask(payload);\r\n    setActivity(prev => [createActivity('add', `Added: ${payload.title}`), ...prev].slice(0, 50));\r\n  }, [addTask, createActivity]);\r\n  const handleUpdate = useCallback((id: string, patch: Partial<Task>) => {\r\n    updateTask(id, patch);\r\n    setActivity(prev => [createActivity('update', `Updated: ${Object.keys(patch).join(', ')}`), ...prev].slice(0, 50));\r\n  }, [updateTask, createActivity]);\r\n  const handleDelete = useCallback((id: string) => {\r\n    deleteTask(id);\r\n    setActivity(prev => [createActivity('delete', `Deleted task ${id}`), ...prev].slice(0, 50));\r\n  }, [deleteTask, createActivity]);\r\n  const handleUndo = useCallback(() => {\r\n    undoDelete();\r\n    setActivity(prev => [createActivity('undo', 'Undo delete'), ...prev].slice(0, 50));\r\n  }, [undoDelete, createActivity]);\r\n  return (\r\n    <Box sx={{ minHeight: '100dvh', bgcolor: 'background.default' }}>\r\n      <Container maxWidth=\"lg\" sx={{ py: { xs: 3, md: 5 } }}>\r\n        <Stack spacing={3}>\r\n          <Stack direction=\"row\" alignItems=\"center\" justifyContent=\"space-between\">\r\n            <Box>\r\n              <Typography variant=\"h3\" fontWeight={700} gutterBottom>\r\n                TaskGlitch\r\n              </Typography>\r\n              <Typography variant=\"body1\" color=\"text.secondary\">\r\n                Welcome back, {user.name.split(' ')[0]}.\r\n              </Typography>\r\n            </Box>\r\n            <Stack direction=\"row\" spacing={2} alignItems=\"center\">\r\n              <Button variant=\"outlined\" onClick={() => {\r\n                const csv = toCSV(filtered);\r\n                downloadCSV('tasks.csv', csv);\r\n              }}>Export CSV</Button>\r\n              <Avatar sx={{ width: 40, height: 40 }}>{user.name.charAt(0)}</Avatar>\r\n            </Stack>\r\n          </Stack>\r\n          {loading && (\r\n            <Stack alignItems=\"center\" py={6}>\r\n              <CircularProgress />\r\n            </Stack>\r\n          )}\r\n          {error && <Alert severity=\"error\">{error}</Alert>}\r\n          {!loading && !error && (\r\n            <MetricsBar\r\n              metricsOverride={{\r\n                totalRevenue: computeTotalRevenue(filtered),\r\n                totalTimeTaken: filtered.reduce((s, t) => s + t.timeTaken, 0),\r\n                timeEfficiencyPct: computeTimeEfficiency(filtered),\r\n                revenuePerHour: computeRevenuePerHour(filtered),\r\n                averageROI: computeAverageROI(filtered),\r\n                performanceGrade: computePerformanceGrade(computeAverageROI(filtered)),\r\n              }}\r\n            />\r\n          )}\r\n          {!loading && !error && (\r\n            <Stack direction={{ xs: 'column', sm: 'row' }} spacing={2} alignItems={{ xs: 'stretch', sm: 'center' }}>\r\n              <TextField placeholder=\"Search by title\" value={q} onChange={e => setQ(e.target.value)} fullWidth />\r\n              <Select value={fStatus} onChange={e => setFStatus(e.target.value)} displayEmpty sx={{ minWidth: 180 }}>\r\n                <MenuItem value=\"All\">All Statuses</MenuItem>\r\n                <MenuItem value=\"Todo\">Todo</MenuItem>\r\n                <MenuItem value=\"In Progress\">In Progress</MenuItem>\r\n                <MenuItem value=\"Done\">Done</MenuItem>\r\n              </Select>\r\n              <Select value={fPriority} onChange={e => setFPriority(e.target.value)} displayEmpty sx={{ minWidth: 180 }}>\r\n                <MenuItem value=\"All\">All Priorities</MenuItem>\r\n                <MenuItem value=\"High\">High</MenuItem>\r\n                <MenuItem value=\"Medium\">Medium</MenuItem>\r\n                <MenuItem value=\"Low\">Low</MenuItem>\r\n              </Select>\r\n\r\n            </Stack>\r\n          )}\r\n          {!loading && !error && (\r\n            <TaskTable\r\n              tasks={filtered}\r\n              onAdd={handleAdd}\r\n              onUpdate={handleUpdate}\r\n              onDelete={handleDelete}\r\n            />\r\n          )}\r\n          {!loading && !error && <ChartsDashboard tasks={filtered} />}\r\n          {!loading && !error && <AnalyticsDashboard tasks={filtered} />}\r\n          {!loading && !error && <ActivityLog items={activity} />}\r\n          <UndoSnackbar open={!!lastDeleted} onClose={handleCloseUndo} onUndo={handleUndo} />\r\n         </Stack>\r\n      </Container>\r\n    </Box>\r\n  );\r\n}\r\n\r\nexport default function App() {\r\n  return (\r\n    <UserProvider>\r\n      <TasksProvider>\r\n        <AppContent />\r\n      </TasksProvider>\r\n    </UserProvider>\r\n  );\r\n}\r\n\r\n\r\n"
        }
    ]
}